<div *ngIf="isLoading" class="w-full h-[75vh] flex items-center justify-center">
  <svg class="loader" width="240" height="240" viewBox="0 0 240 240">
    <circle class="loader-ring loader-ring-a" cx="120" cy="120" r="105" fill="none" stroke="#000" stroke-width="20" stroke-dasharray="0 660" stroke-dashoffset="-330" stroke-linecap="round"></circle>
    <circle class="loader-ring loader-ring-b" cx="120" cy="120" r="35" fill="none" stroke="#000" stroke-width="20" stroke-dasharray="0 220" stroke-dashoffset="-110" stroke-linecap="round"></circle>
    <circle class="loader-ring loader-ring-c" cx="85" cy="120" r="70" fill="none" stroke="#000" stroke-width="20" stroke-dasharray="0 440" stroke-linecap="round"></circle>
    <circle class="loader-ring loader-ring-d" cx="155" cy="120" r="70" fill="none" stroke="#000" stroke-width="20" stroke-dasharray="0 440" stroke-linecap="round"></circle>
  </svg>
</div>
<div *ngIf="!isLoading">
  <app-nav></app-nav>
  <div class="flex pt-16 pb-6 flex-col items-center h-full bg-[#F4F3F2] gap-6">
    <div class="flex flex-col">
      <div class="flex items-center gap-2 text-[18px]">
        <i class="bx bx-microphone" style="color:#ff4f5e"></i>
        <p class="text-[#555555]">{{ 'speak_instruction' | translate }}</p>
      </div>

      <div class="flex flex-col mt-4 justify-center">
        <p class="font-[500]">{{ 'project' | translate }}: <span class="italic font-normal">{{ text?.project ? text.project : 'not_specified' | translate }}</span></p>
        <p class="font-[500]">{{ 'category' | translate }}: <span class="italic font-normal">{{ text?.category ? text.category : 'not_specified' | translate }}</span></p>
      </div>
    </div>

    <div class="relative w-full flex justify-center overflow-x-hidden">
      <div *ngIf="showText" class="text-screen bg-[#FFFFFF] overflow-x-hidden w-[50%] h-[250px] flex justify-center items-center
       shadow-[0px 4px 10px rgba(0, 0, 0, 0.25)]"
           @textSwitch>
        <p class="text-[24px]">{{ text?.content }}</p>
      </div>
    </div>

    <div class="flex items-center justify-between font-[500] text-[#4A4A4A] gap-20 mt-4">
      <div class="flex items-center font-[500] text-[#4A4A4A] gap-4">
        <span *ngFor="let level of [1,2,3,4,5]" class="bg-[#FFFFFF] flex items-center justify-center w-10 h-10 p-2 rounded-[50%]"
              [class.bg-gray-300]="currentTextIndex !== level">
          {{ level }}
        </span>
      </div>
    </div>

    <div class="w-full flex items-center justify-center mt-6">
      <div (click)="toggleRecording()" class="bg-[#FFFFFF] cursor-pointer p-6 rounded-[50%] w-[80px] h-[80px] flex items-center justify-center
                  shadow-[0_4px_10px_rgba(255,0,255,0.2),0_-4px_10px_rgba(0,0,255,0.2)]
                  hover:shadow-[0_5px_12px_rgba(255,0,255,0.3),0_-5px_12px_rgba(0,0,255,0.3)]
                  transition-shadow duration-300 ease-in-out">
        <i *ngIf="!isRecording" class="bx bx-microphone text-[32px]" style="color:#ff4f5e"></i>
        <i *ngIf="isRecording" class="bx bx-stop text-[32px]" style="color:#ff4f5e"></i>
      </div>
    </div>

    <div class="w-full flex justify-between items-center px-40">
      <div class="flex items-center gap-4">
        <a (click)="skipText()" class="flex cursor-pointer items-center gap-2 border font-[500] border-[#DBDBDB] rounded-[30px] px-8 py-3">
          <i class='bx bx-help-circle font-medium'></i>
          {{ 'guide' | translate }}
        </a>

        <a (click)="sendRecording()" class="flex cursor-pointer font-[500] items-center gap-2 border rounded-[30px] px-8 py-3">
          {{ 'report' | translate }}
        </a>
      </div>
      <div class="flex items-center gap-4">
        <a (click)="skipText()" class="flex cursor-pointer font-[500] items-center gap-2 border border-[#DBDBDB] rounded-[30px] px-8 py-3">
          <i class="bx bx-chevrons-right font-medium"></i>
          {{ 'skip' | translate }}
        </a>

        <a (click)="sendRecording()" class="flex cursor-pointer font-[500] items-center gap-2 border border-[#DBDBDB] rounded-[30px] px-8 py-3"
           [class.opacity-50]="isSendDisabled" [class.cursor-not-allowed]="isSendDisabled">
          {{ 'send' | translate }}
        </a>
      </div>
    </div>
  </div>

  <div *ngIf="isModalOpen" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
    <div class="bg-white p-6 rounded-lg shadow-lg text-center">
      <p class="text-lg font-semibold mb-4">{{ 'restart_question' | translate }}</p>
      <div class="flex justify-center gap-4">
        <button (click)="restartLevels()" class="px-4 py-2 bg-blue-500 text-white rounded">{{ 'restart' | translate }}</button>
        <button (click)="finishSession()" class="px-4 py-2 bg-gray-300 rounded">{{ 'finish' | translate }}</button>
      </div>
    </div>
  </div>

</div>
